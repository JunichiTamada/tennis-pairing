# 🎾 Tennis Pairing App v1.1.0

テニスのダブルス練習・試合で、**公平かつ楽しいペアリングを自動生成するアプリ**です。  
2025年10月リリースの v1.1.0 では、新たに **Undo（直前ラウンドの取り消し）機能** を搭載しました。

---

## 🆕 更新内容（v1.1.0）

| 項目 | 内容 |
|------|------|
| **新機能** | Undo（直前ラウンドの取り消し）ボタンを追加 |
| **内部構成** | `src/hooks/useHistoryStack.ts` を追加し、ラウンド履歴スナップショットを管理 |
| **仕様** | ラウンド生成直前の状態を自動保存し、1ステップ前に戻すことが可能に |
| **保存範囲** | 履歴スタックはページ内メモリで保持（リロードで消失） |
| **検討中の仕様** | 「今日の状態を消去」後の乱数挙動を、<br>①決定論的タイブレーク or ②ランダム再初期化 のどちらにするか検討中 |

---

## 🧩 主な機能

| 機能 | 概要 |
|------|------|
| **ペア自動生成** | 当日の履歴に基づき、同一ペア・対戦の再現を避けつつ自動でペアリング |
| **重み調整** | 「同一ペア」「同一対戦」「直前類似ペナ」などの重みをスライダーで設定可能 |
| **復帰者優先** | 一時離脱（away）状態の復帰者は次のラウンドで優先的に選出 |
| **離脱操作** | 長押し（スマホ）または右クリック（PC）で一時離脱／復帰を切替 |
| **Undo機能（v1.1新機能）** | 「直前ラウンドを取り消す」ボタンで、直前の状態に戻すことが可能 |
| **自動保存** | 当日の状態はブラウザの localStorage に自動保存。翌日は自動リセット |
| **屋外モード** | 高輝度ディスプレイ向けのカラーモード切替 |
| **自己テスト** | バージョン番号を5回クリックで動作確認用テストを実行 |

---

## 🖥️ 画面構成

1. **設定カード**
   - 屋外モード切替
   - 重みリセット
   - ヘルプ表示／今日の状態を消去

2. **参加者リスト**
   - タップで選択／解除  
   - 長押し（スマホ）または右クリック（PC）で一時離脱  
   - 「★復帰」マーク付きは前ラウンドで休憩していた参加者

3. **ペア決定カード**
   - 「次のペアを決める」ボタン：自動生成
   - 「直前ラウンドを取り消す」ボタン：Undo機能（v1.1）

4. **ラウンド履歴**
   - 最新ラウンドが上部に表示され、ハイライトされます  
   - 対戦ペアと休憩者を明示表示  

---

## ⚙️ 内部構成

```
src/
├── App.tsx                     # メインUIロジック
├── hooks/
│   └── useHistoryStack.ts      # v1.1新規：Undoスタック管理
├── components/
│   └── ui/                     # Button, CardなどのUI部品
├── assets/
│   └── ...                     # CSS, アイコン, 画像
```

### useHistoryStack.ts の概要
Undo 機能のための簡易スタックフックです。

- `push(snapshot)`：現在状態を保存  
- `pop()`：1つ前の状態を取得して削除  
- `clear()`：履歴クリア  
- 保存はメモリ＋localStorage（リロード時にも一部保持可能）

---

## 🚀 デプロイ構成

| デプロイ先 | ブランチ | ビルドベース | 備考 |
|-------------|-----------|---------------|-------|
| `/tennis-pairing/` | `main` | `/tennis-pairing/` | メイン（v2相当） |
| `/tennis-pairing/v1/` | `release/v1` | `/tennis-pairing/v1/` | v1.1 (Undo付き) |
| `/tennis-pairing/v2-preview/` | `main` | `/tennis-pairing/v2-preview/` | v2プレビュー |

ビルドとPagesデプロイは `.github/workflows/deploy-pages.yml` により自動化されています。

---

## 🧠 開発メモ（技術的補足）

- Undo履歴は `participants` と `rounds` のスナップショットのみ保存  
- `localStorage` のキーは以下：
  - `tdoubles_state_v1`：当日データ  
  - `tdoubles_prefs_v1`：屋外モード・表示設定
  - `undo_v1_1`：Undo履歴
- ランダム生成は `mulberry32(strToSeed(todayStr()))` により当日固定シード化  
- 今後の案：
  - `nonce`（消去カウント）を混ぜて日内乱数を分岐  
  - RNG状態をUndoスナップショットに含めるかを検討中

---

## 📅 バージョン履歴

| バージョン | 日付 | 内容 |
|-------------|------|------|
| **v1.0.0** | 2025-09 | 初期リリース。ペア自動生成＋重み調整機能 |
| **v1.0.1** | 2025-09 | BrowserRouter `basename` 修正 |
| **v1.1.0** | 2025-10 | Undo機能追加・内部構造整理・安定化対応 |

---

## 🧾 ライセンス

本プロジェクトは **MIT License** の下で提供されています。詳細は [LICENSE](./LICENSE) をご参照ください。

---

## 👥 今後の改善予定
- 「今日の状態を消去」後の乱数再現性を選択可能にする（決定論 or ランダム）
- Undo履歴をブラウザ永続化するオプションの検討
- ペア固定（ロック）機能との共存テスト
- モバイル表示最適化・スワイプUI検討

---

## 🧾 開発
- © 2025 Junichi Tamada  
- 開発環境: React + TypeScript + Vite  
- ホスティング: GitHub Pages
